    PATCHED SOUND ROUTINE FOR SUPAPLEX/SPEEDFIX (Preliminary patch)


BLASTER.SND is the Sound Blaster sub-program and data file, which is also
part of the complete Supaplex/SpeedFix program package.

Purpose: it generates nice Sound Effects (SFX or FX) only.  Sound Blaster
music is generated by ADLIB.SND.

Because the original BLASTER.SND did not work properly, it has been patched
to work on modern PC's.  Furthermore a severe bug has been fixed.


Changes:
--------

Bug: wrong index calculation for local storage of saved interrupt vectors.
This bug caused part of the program in memory being overwritten, with
random side effects.   Fixed in two places: save and restore vectors.


The Sound Blaster base address is fixed by Supaplex at 220h, and used either
IRQ 2, IRQ 3, IRQ5 or IRQ 7.  Checking for the used IRQ, this sub-program
crashes many new PC's when IRQ 2 is tested.  This patched version does not
test for IRQ 2 anymore, but the Sound Blaster can still use IRQ 3, IRQ 5 or
IRQ 7, at will.  The base address 220h has not been changed.


Because there are several waiting loops inside, which do not use any timer,
but rely on the delay caused by processor intructions, several of those
loops have been increased drastically.  This gives the Sound Blaster more
time to react on present day computers.  When PC's become still faster,
another way of generating such delays has to be implemented, which would
mean that a lot more work has to be done!


Tested on:
---------

Several PC's running Windows 98SE:
500 MHz Pentium III with Sound Blaster 128 PCI (Also nice Roland sound)
500 MHz Pentium III with Sound Blaster 64V PCI (Thanks to Joop v. Osch)
133 MHz Pentium with on-board Vibra 16 (Roland not working)


More information about Supaplex sound:
-------------------------------------

Music and Sound Effects are two different things in Supaplex.

Supaplex MUSIC is ALWAYS generated by:

 BEEP.SND    (Internal Speaker)
 ADLIB.SND   (Sound Blaster at 388h)
 ROLAND.SND  (MPU-401 in UART mode at 330h)

These three sub-programs also contain some elementary Sound Effects, and
are all completely timed by the Supaplex internal timer routine (50 Hz).

For much better Sound Effects, the additional two sub-programs are needed:

 SAMPLE.SND  (Internal Speaker, supported by additional hardware timers)
 BLASTER.SND (Sound Blaster at 220h, DMA 1, and either IRQ 3, IRQ 5 or IRQ 7)

Note that these two additional sub-programs are for Sound Effects only, and
use extra resources (especially SAMPLE.SND), which may cause Windows not to
accept these routines, and may then suggest to use pure DOS-mode instead.

(Maybe SAMPLE.SND will be patched too someday, so Windows will accept it.)


Configuration screen information:
--------------------------------

There are several sound chips to click, apart from the keyboard/joystick:

With MUSIC and FX, music and Sound Effects can be controlled separately.

INTERNAL STANDARD  uses BEEP.SND   for both music and FX.
INTERNAL SAMPLES   uses BEEP.SND   for music and SAMPLE.SND for FX.
ADLIB              uses ADLIB.SND  for both music and FX.
BLASTER            uses ADLIB.SND  for music and BLASTER.SND for FX.
ROLAND             uses ROLAND.SND for both music and FX.
COMBINED           uses ROLAND.SND for music and BLASTER.SND for FX.


-----------------------------------------------------------------------------
Have fun,
Herman Perk

Don't forget to send comments and more info to me, in case it doesn't work:
Herman_Perk@compuserve.com
